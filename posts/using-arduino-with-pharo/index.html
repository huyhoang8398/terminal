<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Using Arduino With PharoThings/Smalltalk :: Do Hoang — Software developer</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Firmata Firmata is a generic protocol for communicating with microcontrollers from software on a host computer. It is intended to work with any host computer software package. Right now there is a matching object in a number of languages. It is easy to add objects for other software to use this protocol. Basically, this firmware establishes a protocol for talking to the Arduino from the host software. The aim is to allow people to completely control the Arduino from software on the host computer."/>
<meta name="keywords" content="PharoThings"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/using-arduino-with-pharo/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using Arduino With PharoThings/Smalltalk"/>
<meta name="twitter:description" content="Using Arduino With PharoThings/Smalltalk with Firmata"/>



<meta property="og:title" content="Using Arduino With PharoThings/Smalltalk" />
<meta property="og:description" content="Using Arduino With PharoThings/Smalltalk with Firmata" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/using-arduino-with-pharo/" />
<meta property="article:published_time" content="2019-12-02T19:57:14+07:00" />
<meta property="article:modified_time" content="2019-12-02T19:57:14+07:00" /><meta property="og:site_name" content="Do Hoang" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">$ cd /home/kn</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/">Blog</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/">Blog</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/using-arduino-with-pharo/">Using Arduino With PharoThings/Smalltalk</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-12-02
        </span>
      
      <span class="post-author">— Written by kn</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/pharothings/">PharoThings</a>&nbsp;
        
          #<a href="/tags/smalltalk/">smalltalk</a>&nbsp;
        
          #<a href="/tags/arduino/">arduino</a>&nbsp;
        
          #<a href="/tags/iot/">iot</a>&nbsp;
        
          #<a href="/tags/blog/">blog</a>&nbsp;
        
      </span>
    

    
      
        <img src="/posts/using-arduino-with-pharo/images/teaser50.png" class="post-cover" />
      
    

    <div class="post-content">
      <h2 id="firmata">Firmata</h2>
<p>Firmata is a generic protocol for communicating with microcontrollers from software on a host computer.
It is intended to work with any host computer software package. Right now there is a matching object in a number of languages.
It is easy to add objects for other software to use this protocol.
Basically, this firmware establishes a protocol for talking to the Arduino from the host software.
The aim is to allow people to completely control the Arduino from software on the host computer.</p>
<h3 id="what-do-we-need">What do we need?</h3>
<p>In this lesson, we will use a setup with Pharo and Firmata.</p>
<p><strong>Components</strong></p>
<ul>
<li>1 Arduino Uno</li>
<li>1 Breadboard</li>
<li>1 LED</li>
<li>1 Resistor (330 ohms)</li>
<li>1 Soil Moisture Sensor</li>
<li>Jumper wires</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="arduino-installing-standard-firmata">Arduino: Installing Standard Firmata</h3>
<p>Your first step should be to download the Arduino application from
<a href="https://www.arduino.cc/en/Main/Software"><em>Arduino Website</em>.</a>
Be sure to choose the latest version and also the correct download for your computer and operating system.
Once the software has downloaded, you can install the application using the method appropriate for your system.</p>
<ul>
<li>For <code>Mac OSX</code>, you will be downloading a ZIP file. Double-clicking on the ZIP should produce a single &ldquo;Arduino&rdquo; application file  which you can then copy into your Applications folder.</li>
<li>For <code>Windows</code>, you should download the .EXE containing a full Windows installer. Double clicking on the .EXE should start the installation.</li>
<li>For <code>Linux</code>, you will download a compressed TAR file. You can use the &ldquo;tar&rdquo; command to uncompress and unpack the application.
Plug in Your Arduino Board as shown in Figure below.

  <figure class="center" >
    <img src="/posts/using-arduino-with-pharo/images/IMG_3231.JPG"  alt="Arduino Connection"   style="border-radius: 12px;"  />
    
      <figcaption class="center"  style="color: red;" >Arduino Connection!</figcaption>
    
  </figure>

</li>
</ul>
<p><strong>Note:</strong> Disconnect any wires that may be attached to your Arduino and plug the board into the computer.
You'll need to select the entry in the <code>Tools &gt; Board menu</code> that corresponds to your Arduino board.</p>
<ul>
<li>Here we are using Arduino UNO board and my port is <code>/dev/tty.usbmodem14201</code> ( You may have a different port name depend on your operating system ).</li>
<li>Upload the Standard Firmata Sketch.

  <figure class="center" >
    <img src="/posts/using-arduino-with-pharo/images/firmataExample.JPG"  alt="Standard Firmata Example"   style="border-radius: 12px;"  />
    
      <figcaption class="center"  style="color: red;" >Standard Firmata Example</figcaption>
    
  </figure>

</li>
<li>StandardFirmata is included with the Arduino IDE. To compile and upload StandardFirmata to your Arduino, open the IDE and select <code>File/Examples/Firmata/StandardFirmata</code>.</li>
<li>Now at the top of the text editor window, click the <code>Upload</code> button on the IDE.</li>
<li>At the bottom of the text editor window, you should see a small status window. This will report the progress as the code is compiled  and then uploaded to the Arduino.</li>
<li>While the code is being uploaded, you should see some very small LED lights (the Transmit (TX) and Receive (RX) lights) on your Arduino board blinking as the data is transferred.</li>
<li>When the process is completed, you should see the message <code>Done Uploading</code> in the status window at the bottom of the editor.</li>
</ul>
<h2 id="pharo-with-firmata">Pharo with Firmata</h2>
<p>To load latest version of Firmata you can evaluate the following expression in playground:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  <span style="color:#a6e22e">Metacello</span> new
  <span style="color:#a6e22e">baseline:</span> <span style="color:#e6db74">&#39;Firmata&#39;</span>;
  <span style="color:#a6e22e">repository:</span> <span style="color:#e6db74">&#39;github://pharo-iot/Firmata&#39;</span>;
  <span style="color:#a6e22e">load</span>
</code></pre></div><p>We have tested this library so far with Arduino Uno and Funduino Uno.
To connect to your firmatata enable device, you need the following things:</p>
<ul>
<li>Know the device's port name.</li>
<li>Know its baud rate.</li>
<li>Install firmata in it (you can do it using your arduino IDE).</li>
</ul>
<p>For example, our Arduino boards use a baud rate of 57600, and were detected by our operating system in the /dev/ttyACM0 port.
Connecting the Firmata client to arduino is as easy as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Firmata</span> <span style="color:#a6e22e">onPort:</span> <span style="color:#e6db74">&#39;/dev/ttyACM0&#39;</span> <span style="color:#a6e22e">baudRate:</span> <span style="color:#ae81ff">57600</span>.
</code></pre></div><p>Connecting to an arduino will check that the port exists, and will verify that Arduino has installed a compatible version of Firmata.
In case one of these conditions does not hold, an exception is thrown.
Once we are connected, we can ask the Firmata driver if it is connected or not.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">isConnected</span>.
</code></pre></div><p>And finally, we can disconnect it by doing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">disconnect</span>.
</code></pre></div><h2 id="digital-pins">Digital Pins</h2>
<p>The <code>digital inputs and outputs</code> (digital I/O) on the Arduino are what allow you to connect the Arduino sensors, actuators, and chips (intergrated circuit).
For example in Arduino UNO which is a microcontroller board based on the <em>ATmega328</em>.
It has a few types of pins: <strong>digital pin</strong> ( 6 can be used as PWM outputs ), <strong>analog pins</strong> and orther pins like <strong>power pins</strong></p>
<p>The <code>digital pins</code> on the Arduino can be configured as either inputs or outputs.
There are only two state, either ON or OFF state and these states are represented by the binary values 1 and 0.
You use digital signals in situations where the input or output will have one of those two values.
In Arduino sketch terms, a ON state is known as HIGH (5V) and OFF state is known as LOW (0V).
In other words, we can use them to obtain a digital value (for example, if a button is pressed or not), or to set a value (set if a led is turned on or off) but not both at the same time.</p>
<h2 id="writing-to-digital-pins">Writing to Digital Pins</h2>
<p>To write to a digital pin, you should first set it to output mode using the <code>digitalPin:mode: message</code>.
The first argument of the message is the number of the pin, and the second is a numeric value representing the output mode value.
We use the <code>FirmataConstants</code> class that encapsulates many of the different numeric values used by firmata.
In the following example, we set the digital pin 13 in output mode, so we can write to it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">digitalPin:</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">mode:</span> <span style="color:#a6e22e">FirmataConstants</span> <span style="color:#a6e22e">pinModeOutput</span>.
</code></pre></div><p>We can then write to a digital port with the <code>#digitalWrite:value: message</code>, giving the pin number as first argument, and the value to write (0 or 1) as second argument.
Thus, to turn on the pin 13 we can do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">digitalWrite:</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">value:</span> <span style="color:#ae81ff">1</span>.
</code></pre></div><p>And to turn it off:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">digitalWrite:</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">value:</span> <span style="color:#ae81ff">0</span>.
</code></pre></div><p>You can use this method to toggle the LED as shown in Figure bellow.</p>

  <figure class="center" >
    <img src="/posts/using-arduino-with-pharo/images/IMG_3227.JPG"  alt="Controlling LED with Arduino via Digital pins"   style="border-radius: 12px;"  />
    
      <figcaption class="center"  style="color: red;" >Controlling LED with Arduino via Digital pins</figcaption>
    
  </figure>


<h2 id="reading-from-digital-pins">Reading from Digital Pins</h2>
<p>To read from a digital pin, you should first set it to input mode using the <code>#digitalPin:mode: message</code>.
The first argument of the message is the number of the pin, and the second is a numeric value representing the input mode value.
We use the FirmataConstants class that encapsulates many of the different numeric values used by firmata.</p>
<p>In the following example, we first setup a push down button with a pull-down resistor.
We connect the button output to digital pin 2.
When we push the button and Firmata should tell us that the value of pin 2 is 1. When we do not push it, its value should be 0.</p>

  <figure class="center" >
    <img src="/posts/using-arduino-with-pharo/images/digitalPinExample.jpg"  alt="Pull-down Resistor Button Sketch"   style="border-radius: 12px;"  />
    
      <figcaption class="center"  style="color: red;" >Pull-down Resistor Button Sketch</figcaption>
    
  </figure>


<p>First, we set the digital pin 2 in input mode, so we can read from it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">digitalPin:</span> <span style="color:#ae81ff">2</span> <span style="color:#a6e22e">mode:</span> <span style="color:#a6e22e">FirmataConstants</span> <span style="color:#a6e22e">pinModeInput</span>.
</code></pre></div><p>Then, we can read the value of the pin using the <code>#digitalRead:</code> message.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">digitalRead:</span> <span style="color:#ae81ff">2</span>.
</code></pre></div><p>If we ask the value and press the button at the same time, we get the value 1.</p>
<h2 id="analog-pins">Analog Pins</h2>
<p>Analog pins are pins whose state range in the continuum between 0 and 1. These states are represented as floating point numbers.</p>
<p>As with digital pins, analog pins work both in read and write mode.
Typical usages of reading analog pins is retrieving data from sensors, such as temperature, humidity, light and so on.
Writing analog pins can be used to, for example, turn on leds with a given intensity instead of just <em>turning on</em> like we do with the digital pins.</p>
<h2 id="activating-analog-pins">Activating Analog Pins</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">activateAnalogPin:</span> <span style="color:#ae81ff">0</span>.
</code></pre></div><h2 id="reading-from-analog-pins">Reading from Analog Pins</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  ((firmata <span style="color:#a6e22e">analogRead:</span> <span style="color:#ae81ff">0</span>) <span style="color:#a6e22e">*</span> <span style="color:#ae81ff">500</span> <span style="color:#a6e22e">/</span> <span style="color:#ae81ff">1024</span>) <span style="color:#a6e22e">asFloat</span>.
</code></pre></div><h2 id="experimental-procedure">Experimental procedure</h2>
<p>The Soil Moisture Sensor measures soil moisture grace to the changes in electrical conductivity of the earth ( soil resistance increases with drought ).
The electrical resistance is measured between the two electrodes of the sensor.
A comparator activates a digital output when a adjutable threshold is exceeded.
There are a lot of moisture sensors but in our example, we use the Capacitive Soil Moisture Sensor from DFTrobot as the figure <em>@Capacitive-Soil-Moisture Sensor</em></p>

  <figure class="center" >
    <img src="/posts/using-arduino-with-pharo/images/SEN0193.jpg"  alt="Capacitive-Soil-Moisture Sensor"   style="border-radius: 12px;"  />
    
      <figcaption class="center"  style="color: red;" >Capacitive-Soil-Moisture Sensor</figcaption>
    
  </figure>


<p>The Figure <em>@Capacitive-Soil-Moisture Sensor Sketch</em> shows how the electric connection is made.</p>

  <figure class="center" >
    <img src="/posts/using-arduino-with-pharo/images/capacitiveSoilMoistureSensor.png"  alt="Capacitive-Soil-Moisture Sensor Sketch"   style="border-radius: 12px;"  />
    
      <figcaption class="center"  style="color: red;" >Capacitive-Soil-Moisture Sensor Sketch</figcaption>
    
  </figure>


<table>
<thead>
<tr>
<th>Aduino Uno</th>
<th>Capacitive Soil Moisture Sensor</th>
</tr>
</thead>
<tbody>
<tr>
<td>GND</td>
<td>Black wire</td>
</tr>
<tr>
<td>5V</td>
<td>Red Wire</td>
</tr>
<tr>
<td>Analog output</td>
<td>Blue Wire</td>
</tr>
</tbody>
</table>
<h2 id="connecting-the-firmata-client-to-arduino">Connecting the Firmata client to arduino</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Firmata</span> <span style="color:#a6e22e">onPort:</span> <span style="color:#e6db74">&#39;/dev/ttyACM0&#39;</span> <span style="color:#a6e22e">baudRate:</span> <span style="color:#ae81ff">57600</span>.
</code></pre></div><h2 id="check-the-firmata-connection">Check the firmata connection</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">isConnected</span>.
</code></pre></div><h2 id="getting-the-temperature-with-capacitivesoilmoisture-sensor">Getting the temperature with Capacitive-Soil-Moisture Sensor</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-smalltalk" data-lang="smalltalk">  firmata <span style="color:#a6e22e">activateAnalogPin:</span> <span style="color:#ae81ff">0</span>.
  firmata <span style="color:#a6e22e">analogRead:</span><span style="color:#ae81ff">0</span>.
</code></pre></div><h2 id="result">Result</h2>
<p>This is very simple and you can get these values and stored in a variable, to use to different purposes, like send a message to an LCD display, send the values to a cloud server and simply do some action.</p>

  <img src="/posts/using-arduino-with-pharo/images/result.png"  alt="Capacitive-Soil-Moisture Sensor with Arduino via Firmata Result"  class="center"  style="border-radius: 8px;"  />



    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="/posts/git-revert-to-a-good-commit/">
                <span class="button__text">Git Revert to a Good Commit</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">$ cd /home/kn</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2019 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
